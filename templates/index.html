<!DOCTYPE html>
<html>
  <head>
    <title>AGI Therapist: Perception-Memory-Cognition</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #f4f7f6;
      }
      .container {
        text-align: center;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
      }
      button {
        padding: 12px 25px;
        font-size: 16px;
        margin: 10px;
        cursor: pointer;
        border: none;
        border-radius: 25px;
        color: white;
        transition: transform 0.2s, background-color 0.2s;
      }
      #start { background-color: #2ecc71; }
      #start:hover { background-color: #27ae60; transform: scale(1.05); }
      #stop { background-color: #e74c3c; display: none; }
      #stop:hover { background-color: #c0392b; transform: scale(1.05); }
      
      .section {
        margin-top: 20px;
        text-align: left;
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
      }
      .perception-box { background: #e8f4fd; border-left: 5px solid #3498db; }
      .cognition-box { background: #fff9db; border-left: 5px solid #f1c40f; }
      .memory-box { background: #f2f2f2; border-left: 5px solid #7f8c8d; }
      
      pre { white-space: pre-wrap; word-wrap: break-word; }
      #loading { display: none; margin: 20px 0; font-weight: bold; color: #3498db; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>AGI Therapist Integrated System</h1>
      <p> Research Project: 7th Sem</p>
      
      <div id="timer">Time: 0s</div>
      <button id="start" onclick="startRecording()">Start Recording</button>
      <button id="stop" onclick="stopRecording()">Stop Recording</button>

      <div id="loading">üß† AGI is Thinking...</div>

      <div class="section cognition-box">
        <h3>üß† Therapeutic Insights (Brain)</h3>
        <div id="insight-summary" style="font-weight: bold; margin-bottom: 10px; color: #856404;"></div>
        <pre id="cognition-details">Waiting for audio analysis...</pre>
      </div>

      <div class="section perception-box">
        <h3>üéôÔ∏è Perception Result</h3>
        <pre id="result">Transcript will appear here...</pre>
      </div>

      <div class="section memory-box">
        <h3>üíæ Memory Logs (LTM)</h3>
        <pre id="ltm-logs">Historical data will appear here...</pre>
      </div>
    </div>

    <script>
      let mediaRecorder;
      let audioChunks = [];
      let startTime;
      let timerInterval;

      async function startRecording() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];
          startTime = Date.now();
          mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
          mediaRecorder.onstop = () => {
            stream.getTracks().forEach(t => t.stop());
            sendAudio();
          };
          mediaRecorder.start();
          document.getElementById("start").style.display = "none";
          document.getElementById("stop").style.display = "inline-block";
          timerInterval = setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById("timer").innerText = `Time: ${elapsed}s`;
            if (elapsed >= 10) stopRecording();
          }, 1000);
        } catch (err) { alert("Mic error: " + err); }
      }

      function stopRecording() {
        if (mediaRecorder?.state === "recording") {
          mediaRecorder.stop();
          clearInterval(timerInterval);
          document.getElementById("stop").style.display = "none";
          document.getElementById("start").style.display = "inline-block";
        }
      }

      async function sendAudio() {
        const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
        const formData = new FormData();
        formData.append("audio", audioBlob, "recording.wav");
        formData.append("user_id", "Vaibhav_Test");

        document.getElementById("loading").style.display = "block";
        
        try {
          const response = await fetch("/analyze", { method: "POST", body: formData });
          const data = await response.json();

          // Update UI with Data
          document.getElementById("result").innerText = `Transcript: "${data.transcript}"\n\n${JSON.stringify(data.perception, null, 2)}`;
          
          document.getElementById("insight-summary").innerText = `Recommendation: ${data.recommendation}`;
          document.getElementById("cognition-details").innerText = JSON.stringify(data.cognitive_insights, null, 2);
          
          document.getElementById("ltm-logs").innerText = JSON.stringify(data.long_term_memory, null, 2);

        } catch (err) {
          document.getElementById("cognition-details").innerText = "Error: " + err;
        } finally {
          document.getElementById("loading").style.display = "none";
        }
      }
    </script>
  </body>
</html>